---
title: "Generalized Linear Models in 3D"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Generalized Linear Models in 3D}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = F,
  warning = F
)
```

## Introduction

A multiple *linear* regression creates a flat regression surface. A multiple linear regression with an *interaction* term can be depicted as a curved regression surface with linear marginal effects. A *generalized linear model (glm)* takes a linear component as a variable in a nonlinear function, creating a curved regression surface with nonlinear marginal effects. 

This vignette demonstrates a binomial model and a Gamma model. At this time, __regress3d__ has been tested on binomial models, negative binomials, and Gammas, but it should work for all generalized linear models. The function `add_jitter()` is demonstrated in the example of a binomial glm. Note that interaction terms are also allowed in the graphics for generalized linear regressions.

# Setup

The package regress3d is built on the syntax of plotly in R. Both libraries are called in the initial setup.

```{r setup}
library(regress3d)
library(plotly)
```


# Logistic Regression

### Data

The variables in the regression are county level measures from 2016.

* `plurality_Trump16`: a binary variable indicating whether the plurality of a county voted for Trump in 2016.
* `any_college`: the percent of adults in the county that had ever enrolled in college, regardless of whether they graduated.
* `prcnt_black`: the percent of the county that identified as Black in the 2016 census. 

The regression is weighted by `pop_estimate16`, the number of people in a county, to capture the influence of large counties.


```{r, out.width = "800px", out.height = "450px"}
mymodel <- glm(plurality_Trump16 ~ any_college+prcnt_black, 
               data = county_data, family = "binomial")

plot_ly( data = county_data,
                        x = ~any_college,
                        y = ~prcnt_black,
                        z = ~plurality_Trump16) %>%
  add_markers(size = 1, color = I('black'))%>%
  add_3d_surface(model = mymodel, ci = T) %>%
  add_marginals(model = mymodel, ci = T) 

```

# Gamma Model

```{r}
county_data %>%
  ggplot(aes(x = median_income16)) +
  geom_histogram()
```

```{r, out.width = "800px", out.height = "450px"}
mymodel <- glm(median_income16 ~ prcnt_black +any_college, 
               data = county_data, weight = pop_estimate16, family = Gamma)

p <- plot_ly( data = county_data,
              x = ~prcnt_black,
              y = ~any_college,
              z = ~median_income16) %>%
  add_markers(size = ~pop_estimate16, color = I('black')) %>%
  add_3d_surface(model = mymodel)%>%
  add_marginals(model = mymodel) 

p
```


```{r, out.width = "800px", out.height = "450px", eval = F, echo = F}
# mymodel <- glm(median_income16 ~ prcnt_black *any_college, data = county_data, family = Gamma)
# p <- plot_ly( data = county_data,
#               x = ~prcnt_black,
#               y = ~any_college,
#               z = ~median_income16) %>%
#   add_markers(size = ~pop_estimate16, color = I('black')) %>%
#   add_3d_surface(model = mymodel)%>%
#   add_marginals(model = mymodel) %>%
#   layout(
#     scene = list(
#       zaxis = list(range = c(0, 140000))))
```
